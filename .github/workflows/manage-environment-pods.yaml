name: Manage Environment Pods

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Environment type"
        required: true
        type: choice
        options:
          - Development
          - Production
        default: Development
      environment_name:
        description: "Environment name (namespace)"
        required: true
        type: choice
        options:
          - featest
        default: featest
      action:
        description: "What do you want to do?"
        required: true
        type: choice
        options:
          - stop
          - start
        default: stop

jobs:
  manage-env:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment || github.event.inputs.environment }}
    permissions:
      id-token: write
      contents: read

    steps:
      - name: Azure Login
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      # - name: Set AKS variables
      #   run: |
      #     echo "AKS_RG=dev-zionet-learning-2025" >> $GITHUB_ENV
      #     echo "AKS_NAME=aks-cluster-dev" >> $GITHUB_ENV

      # - name: Get AKS credentials
      #   run: az aks get-credentials --resource-group $AKS_RG --name $AKS_NAME --overwrite-existing

      # - name: Stop / Start environment
      #   run: |
      #     ENV_NAME="${{ github.event.inputs.environment_name }}"
      #     ACTION="${{ github.event.inputs.action }}"

      #     NAMESPACE="$ENV_NAME"

      #     echo "Managing environment: $ENV_TYPE ($ENV_NAME), namespace: $NAMESPACE, action: $ACTION"

      #     if [ "$ACTION" = "stop" ]; then
      #       echo "Stopping all deployments and statefulsets in $NAMESPACE..."
      #       kubectl scale deploy -n "$NAMESPACE" --all --replicas=0
      #       kubectl scale statefulset -n "$NAMESPACE" --all --replicas=0 || true
      #     else
      #       echo "Starting all deployments and statefulsets in $NAMESPACE..."
      #       kubectl scale deploy -n "$NAMESPACE" --all --replicas=1
      #       kubectl scale statefulset -n "$NAMESPACE" --all --replicas=1 || true
      #     fi