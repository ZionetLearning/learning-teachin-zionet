{{- if .Values.keda.enabled }}
apiVersion: http.keda.sh/v1alpha1
kind: HTTPScaledObject
metadata:
  name: manager-http-scaledobject
  namespace: {{ include "app.namespace" . }}
spec:
  hosts:
  - teachin.westeurope.cloudapp.azure.com
  scaleTargetRef:
    name: {{ .Values.manager.name }}
    port: {{ .Values.manager.ports.container }}
    service: manager
  replicas:
    min: 0               # Scale to zero when no traffic
    max: 10               # Maximum replicas
  pollingInterval: 2     # More responsive scaling (was 5)
  scaledownPeriod: 300   # 5 minutes idle before scale down
  targetPendingRequests: 1  # Scale up on any pending request
  scaleUpCooldownPeriod: 5   # Faster scale up (was 10)
  scaleDownCooldownPeriod: 60
  # Add timeout configurations for slow startup
  responseTimeout: 120   # Wait up to 2 minutes for response
  keepAliveTimeout: 60   # Keep connections alive for 1 minute
  targetPendingRequestsThreshold: 100  # Queue more requests before scaling
{{- end }}