{{- if .Values.keda.enabled }}
apiVersion: http.keda.sh/v1alpha1
kind: HTTPScaledObject
metadata:
  name: manager-http-scaledobject
  namespace: {{ include "app.namespace" . }}
spec:
  hosts:
  - teachin.westeurope.cloudapp.azure.com
  scaleTargetRef:
    name: {{ .Values.manager.name }}
    port: {{ .Values.manager.ports.container }}
    service: {{ .Values.manager.name }}  # Ensure this matches the actual service name
  replicas:
    min: 0               # Scale to zero when no traffic (keep KEDA purpose)
    max: 1               # Maximum replicas
  pollingInterval: 1     # Very responsive scaling (check every 1 second)
  scaledownPeriod: 200   # Wait 10 minutes before scaling down (increased)
  targetPendingRequests: 1  # Scale up on any pending request
  # Advanced configuration for better scale-to-zero behavior
  scalingModifiers:
    target: 1
    activationThreshold: 1      # Start scaling on first request
    formula: "ceiling(keda_http_pending_requests / 1)"
{{- end }}