{{- if .Values.keda.enabled }}
apiVersion: http.keda.sh/v1alpha1
kind: HTTPScaledObject
metadata:
  name: manager-http-scaledobject-{{ include "app.namespace" . }}
  namespace: {{ include "app.namespace" . }}
spec:
  hosts:
    - teachin.westeurope.cloudapp.azure.com
  pathPrefixes:
    - /api/{{ include "app.namespace" . }}
    - /auth/login
  scaleTargetRef:
    name: {{ .Values.manager.name }}-{{ .Release.Namespace }}
    port: {{ .Values.manager.ports.service }}
    service: {{ .Values.manager.name }}-{{ .Release.Namespace }} # Ensure this matches the actual service name
  replicas:
    min: 0               # Scale to zero when no traffic (keep KEDA purpose)
    max: 1               # Maximum replicas
  pollingInterval: 1     # Very responsive scaling (check every 1 second)
  scaledownPeriod: 200   # Wait 10 minutes before scaling down (increased)
  targetPendingRequests: 1  # Scale up on any pending request
{{- end }}